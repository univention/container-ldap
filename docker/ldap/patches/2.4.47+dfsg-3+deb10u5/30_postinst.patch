This patch filters OIDs out of the replicated schema that where not internal in the previous
version of OpenLDAP but are internal in the new version of OpenLDAP. This is done in
postinst before the new slapd starts.

This approach is not suitable in cases of OID-changes of internal attributes or objectclasses,
as these affect the previous version of OpenLDAP. That case is currently dealt with by
patching the OID changes back to the previous values (e.g. 31_OLcfg_OIDs.patch).
Next univention-directory-replication.py filters must be extended to the new OIDs.
Only then, in the third step, the back-patch for the OIDs may be removed.

diff -Nuar -x '*.orig' openldap-2.4.31.orig/debian/slapd.postinst openldap-2.4.31/debian/slapd.postinst
--- openldap-2.4.31.orig/debian/slapd.postinst	2012-07-19 14:40:03.439918158 +0200
+++ openldap-2.4.31/debian/slapd.postinst	2012-07-19 14:41:50.120741837 +0200
@@ -158,6 +158,148 @@ if [ "$MODE" = "configure" ] || [ "$MODE" = "reconfigure" ] ; then
 	fi
 fi
 
+# remove built-in OIDs from the schema.conf
+if [ -e /var/lib/univention-ldap/schema.conf ]; then
+	if [ -x "/bin/egrep" ]; then
+		# '1.3.6.1.1.16.4',               # entryUUID
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.1',	# olcAccess
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.2',	# olcAllows
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.3',	# olcArgsFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.4',	# olcAttributeTypes
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.5',	# olcAttributeOptions
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.6',	# olcAuthIDRewrite
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.7',	# olcAuthzPolicy
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.8',	# olcAuthzRegexp
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.9',	# olcBackend
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.10',	# olcConcurrency
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.11',	# olcConnMaxPending
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.12',	# olcConnMaxPendingAuth
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.13',	# olcDatabase
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.14',	# olcDefaultSearchBase
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.15',	# olcDisallows
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.16',	# olcDitContentRules
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.17',	# olcGentleHUP
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.18',	# olcIdleTimeout
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.19',	# olcInclude
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.20',	# olcIndexSubstrIfMinLen
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.21',	# olcIndexSubstrIfMaxLen
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.22',	# olcIndexSubstrAnyLen
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.23',	# olcIndexSubstrAnyStep
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.26',	# olcLocalSSF
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.27',	# olcLogFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.28',	# olcLogLevel
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.30',	# olcModuleLoad
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.31',	# olcModulePath
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.32',	# olcObjectClasses
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.33',	# olcObjectIdentifier
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.34',	# olcOverlay
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.35',	# olcPasswordCryptSaltFormat
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.36',	# olcPasswordHash
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.37',	# olcPidFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.38',	# olcPlugin
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.39',	# olcPluginLogFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.40',	# olcReadOnly
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.41',	# olcReferral
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.43',	# olcReplicaArgsFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.44',	# olcReplicaPidFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.45',	# olcReplicationInterval
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.46',	# olcReplogFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.47',	# olcRequires
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.48',	# olcRestrict
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.49',	# olcReverseLookup
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.51',	# olcRootDSE
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.53',	# olcSaslHost
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.54',	# olcSaslRealm
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.56',	# olcSaslSecProps
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.58',	# olcSchemaDN
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.59',	# olcSecurity
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.60',	# olcSizeLimit
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.61',	# olcSockbufMaxIncoming
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.62',	# olcSockbufMaxIncomingAuth
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.63',	# olcSrvtab
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.66',	# olcThreads
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.67',	# olcTimeLimit
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.68',	# olcTLSCACertificateFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.69',	# olcTLSCACertificatePath
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.70',	# olcTLSCertificateFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.71',	# olcTLSCertificateKeyFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.72',	# olcTLSCipherSuite
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.73',	# olcTLSCRLCheck
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.74',	# olcTLSRandFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.75',	# olcTLSVerifyClient
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.77',	# olcTLSDHParamFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.78',	# olcConfigFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.79',	# olcConfigDir
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.80',	# olcToolThreads
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.81',	# olcServerID
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.82',	# olcTLSCRLFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.83',	# olcSortVals
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.84',	# olcIndexIntLen
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.85',	# olcLdapSyntaxes
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.86',	# olcAddContentAcl
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.87',	# olcTLSProtocolMin
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.88',	# olcWriteTimeout
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.89',	# olcSaslAuxprops
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.90',	# olcTCPBuffer
+		# '1.3.6.1.4.1.4203.666.11.1.3.0.93',   # olcListenerThreads
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.1',	# olcDbDirectory
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.2',	# olcDbIndex
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.3',	# olcDbMode
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.4',	# olcLastMod
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.5',	# olcLimits
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.6',	# olcMaxDerefDepth
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.7',	# olcReplica
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.8',	# olcRootDN
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.9',	# olcRootPW
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.10',	# olcSuffix
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.11',	# olcSyncrepl
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.12',	# olcUpdateDN
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.13',	# olcUpdateRef
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.15',	# olcSubordinate
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.16',	# olcMirrorMode
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.17',	# olcHidden
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.18',	# olcMonitoring
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.19',	# olcSyncUseSubentry
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.0.20',	# olcExtraAttrs
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.1',	# olcDbCacheSize
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.2',	# olcDbCheckpoint
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.3',	# olcDbConfig
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.4',	# olcDbNoSync
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.5',	# olcDbDirtyRead
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.6',	# olcDbIDLcacheSize
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.7',	# olcDbLinearIndex
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.8',	# olcDbLockDetect
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.9',	# olcDbSearchStack
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.10',	# olcDbShmKey
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.11',	# olcDbCacheFree
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.12',	# olcDbDNcacheSize
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.13',	# olcDbCryptFile
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.14',	# olcDbCryptKey
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.15',	# olcDbPageSize
+		# '1.3.6.1.4.1.4203.666.11.1.3.2.1.16',	# olcDbChecksum
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.0',	# olcConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.1',	# olcGlobal
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.2',	# olcSchemaConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.3',	# olcBackendConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.4',	# olcDatabaseConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.5',	# olcOverlayConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.6',	# olcIncludeFile
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.7',	# olcFrontendConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.0.8',	# olcModuleList
+		# '1.3.6.1.4.1.4203.666.11.1.4.2.1.1',	# olcBdbConfig
+		# '1.3.6.1.4.1.4203.666.11.1.4.2.2.1',	# olcLdifConfig
+		# '2.5.4.34', #seeAlso
+		# '0.9.2342.19200300.100.1.1', #userid
+		# '2.5.4.13',  #description
+		# '1.3.6.1.1.1.1.1', # gidNumber
+		# '1.3.6.1.1.1.1.0', #uidNumber
+
+		/bin/egrep -v "1.3.6.1.1.16.4 | 1.3.6.1.4.1.4203.666.11.1.3.0.1 | 1.3.6.1.4.1.4203.666.11.1.3.0.2 | 1.3.6.1.4.1.4203.666.11.1.3.0.3 | 1.3.6.1.4.1.4203.666.11.1.3.0.4 | 1.3.6.1.4.1.4203.666.11.1.3.0.5 | 1.3.6.1.4.1.4203.666.11.1.3.0.6 | 1.3.6.1.4.1.4203.666.11.1.3.0.7 | 1.3.6.1.4.1.4203.666.11.1.3.0.8 | 1.3.6.1.4.1.4203.666.11.1.3.0.9 | 1.3.6.1.4.1.4203.666.11.1.3.0.10 | 1.3.6.1.4.1.4203.666.11.1.3.0.11 | 1.3.6.1.4.1.4203.666.11.1.3.0.12 | 1.3.6.1.4.1.4203.666.11.1.3.0.13 | 1.3.6.1.4.1.4203.666.11.1.3.0.14 | 1.3.6.1.4.1.4203.666.11.1.3.0.15 | 1.3.6.1.4.1.4203.666.11.1.3.0.16 | 1.3.6.1.4.1.4203.666.11.1.3.0.17 | 1.3.6.1.4.1.4203.666.11.1.3.0.18 | 1.3.6.1.4.1.4203.666.11.1.3.0.19 | 1.3.6.1.4.1.4203.666.11.1.3.0.20 | 1.3.6.1.4.1.4203.666.11.1.3.0.21 | 1.3.6.1.4.1.4203.666.11.1.3.0.22 | 1.3.6.1.4.1.4203.666.11.1.3.0.23 | 1.3.6.1.4.1.4203.666.11.1.3.0.26 | 1.3.6.1.4.1.4203.666.11.1.3.0.27 | 1.3.6.1.4.1.4203.666.11.1.3.0.28 | 1.3.6.1.4.1.4203.666.11.1.3.0.30 | 1.3.6.1.4.1.4203.666.11.1.3.0.31 | 1.3.6.1.4.1.4203.666.11.1.3.0.32 | 1.3.6.1.4.1.4203.666.11.1.3.0.33 | 1.3.6.1.4.1.4203.666.11.1.3.0.34 | 1.3.6.1.4.1.4203.666.11.1.3.0.35 | 1.3.6.1.4.1.4203.666.11.1.3.0.36 | 1.3.6.1.4.1.4203.666.11.1.3.0.37 | 1.3.6.1.4.1.4203.666.11.1.3.0.38 | 1.3.6.1.4.1.4203.666.11.1.3.0.39 | 1.3.6.1.4.1.4203.666.11.1.3.0.40 | 1.3.6.1.4.1.4203.666.11.1.3.0.41 | 1.3.6.1.4.1.4203.666.11.1.3.0.43 | 1.3.6.1.4.1.4203.666.11.1.3.0.44 | 1.3.6.1.4.1.4203.666.11.1.3.0.45 | 1.3.6.1.4.1.4203.666.11.1.3.0.46 | 1.3.6.1.4.1.4203.666.11.1.3.0.47 | 1.3.6.1.4.1.4203.666.11.1.3.0.48 | 1.3.6.1.4.1.4203.666.11.1.3.0.49 | 1.3.6.1.4.1.4203.666.11.1.3.0.51 | 1.3.6.1.4.1.4203.666.11.1.3.0.53 | 1.3.6.1.4.1.4203.666.11.1.3.0.54 | 1.3.6.1.4.1.4203.666.11.1.3.0.56 | 1.3.6.1.4.1.4203.666.11.1.3.0.58 | 1.3.6.1.4.1.4203.666.11.1.3.0.59 | 1.3.6.1.4.1.4203.666.11.1.3.0.60 | 1.3.6.1.4.1.4203.666.11.1.3.0.61 | 1.3.6.1.4.1.4203.666.11.1.3.0.62 | 1.3.6.1.4.1.4203.666.11.1.3.0.63 | 1.3.6.1.4.1.4203.666.11.1.3.0.66 | 1.3.6.1.4.1.4203.666.11.1.3.0.67 | 1.3.6.1.4.1.4203.666.11.1.3.0.68 | 1.3.6.1.4.1.4203.666.11.1.3.0.69 | 1.3.6.1.4.1.4203.666.11.1.3.0.70 | 1.3.6.1.4.1.4203.666.11.1.3.0.71 | 1.3.6.1.4.1.4203.666.11.1.3.0.72 | 1.3.6.1.4.1.4203.666.11.1.3.0.73 | 1.3.6.1.4.1.4203.666.11.1.3.0.74 | 1.3.6.1.4.1.4203.666.11.1.3.0.75 | 1.3.6.1.4.1.4203.666.11.1.3.0.77 | 1.3.6.1.4.1.4203.666.11.1.3.0.78 | 1.3.6.1.4.1.4203.666.11.1.3.0.79 | 1.3.6.1.4.1.4203.666.11.1.3.0.80 | 1.3.6.1.4.1.4203.666.11.1.3.0.81 | 1.3.6.1.4.1.4203.666.11.1.3.0.82 | 1.3.6.1.4.1.4203.666.11.1.3.0.83 | 1.3.6.1.4.1.4203.666.11.1.3.0.84 | 1.3.6.1.4.1.4203.666.11.1.3.0.85 | 1.3.6.1.4.1.4203.666.11.1.3.0.86 | 1.3.6.1.4.1.4203.666.11.1.3.0.87 | 1.3.6.1.4.1.4203.666.11.1.3.0.88 | 1.3.6.1.4.1.4203.666.11.1.3.0.89 | 1.3.6.1.4.1.4203.666.11.1.3.0.90 | 1.3.6.1.4.1.4203.666.11.1.3.0.93 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.1 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.2 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.3 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.4 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.5 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.6 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.7 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.8 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.9 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.10 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.11 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.12 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.13 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.15 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.16 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.17 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.18 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.19 | 1.3.6.1.4.1.4203.666.11.1.3.2.0.20 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.1 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.2 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.3 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.4 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.5 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.6 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.7 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.8 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.9 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.10 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.11 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.12 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.13 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.14 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.15 | 1.3.6.1.4.1.4203.666.11.1.3.2.1.16 | 1.3.6.1.4.1.4203.666.11.1.4.0.0 | 1.3.6.1.4.1.4203.666.11.1.4.0.1 | 1.3.6.1.4.1.4203.666.11.1.4.0.2 | 1.3.6.1.4.1.4203.666.11.1.4.0.3 | 1.3.6.1.4.1.4203.666.11.1.4.0.4 | 1.3.6.1.4.1.4203.666.11.1.4.0.5 | 1.3.6.1.4.1.4203.666.11.1.4.0.6 | 1.3.6.1.4.1.4203.666.11.1.4.0.7 | 1.3.6.1.4.1.4203.666.11.1.4.0.8 | 1.3.6.1.4.1.4203.666.11.1.4.2.1.1 | 1.3.6.1.4.1.4203.666.11.1.4.2.2.1 | 2.5.4.34 | 0.9.2342.19200300.100.1.1 | 2.5.4.13 | 1.3.6.1.1.1.1.1 | 1.3.6.1.1.1.1.0 " /var/lib/univention-ldap/schema.conf >/var/lib/univention-ldap/schema.conf.BAK || true
+
+		cp /var/lib/univention-ldap/schema.conf.BAK /var/lib/univention-ldap/schema.conf
+	fi
+fi
+
 # Configuration.
 if is_initial_configuration "$@"; then
 	postinst_initial_configuration
