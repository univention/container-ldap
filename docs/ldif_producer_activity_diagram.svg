<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1210px" preserveAspectRatio="none" style="width:1742px;height:1210px;" version="1.1" viewBox="0 0 1742 1210" width="1742px" zoomAndPan="magnify"><defs><filter height="300%" id="f8mmnx1rlwuqj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="877.75" cy="20" fill="#000000" filter="url(#f8mmnx1rlwuqj)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="748" x="503.75" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="329" x="513.75" y="71.1387">socketserver = slapdsock.service.SlapdSockServer()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="728" x="513.75" y="85.1074">:handler = slapdsocklistener.LDAPHandler(ReasonableSlapdSockHandler(SlapdSockHandler(BaseRequestHandler)))</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="121" x="817.25" y="117.9375"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="101" x="827.25" y="139.0762">Start event loop</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="815.25" y="171.9063"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="825.25" y="193.0449">Connect to NATS</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="353" x="701.25" y="225.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="333" x="711.25" y="247.0137">Read jornal and send pending old messages to NATS</text><rect fill="#000000" filter="url(#f8mmnx1rlwuqj)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1721.5" x="10" y="279.8438"/><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="372.2031" style="stroke: #000000; stroke-width: 2.0;" width="244" x="22" y="561.374"/><path d="M202,562.374 L202,570.6709 L192,580.6709 L22,580.6709 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="170" x="25" y="575.3691">Send Messages to NATS</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="46" y="669.6709"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="56" y="690.8096">get message from queue</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="165" x="52.5" y="738.6396"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="145" x="62.5" y="759.7783">send message to NATS</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="32" y="807.6084"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="186" x="42" y="828.7471">remove message from journal</text><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="135,597.6709,147,609.6709,135,621.6709,123,609.6709,135,597.6709" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="72,889.5771,198,889.5771,210,901.5771,198,913.5771,72,913.5771,60,901.5771,72,889.5771" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="118" x="76" y="905.3853">no SIGINT / SIGTERM</text><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="834.4707" style="stroke: #000000; stroke-width: 2.0;" width="1443.5" x="276" y="296.6455"/><path d="M378,297.6455 L378,322.2393 L368,332.2393 L276,332.2393 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="279" y="310.6406">SocketServer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="279" y="326.9375">Main Thread</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="917.25" y="349.2393"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="179" x="927.25" y="370.3779">socketserver.serve_forever()</text><rect fill="#000000" filter="url(#f8mmnx1rlwuqj)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1423.5" x="286" y="403.208"/><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="229" x="306" y="665.3975"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="209" x="316" y="686.5361">listen for messages in the socket</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="99.8438" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="202" x="319.5" y="734.3662"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="329.5" y="755.5049">handle_request()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="319.5" x2="521.5" y1="763.335" y2="763.335"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319.5" x2="521.5" y1="765.335" y2="765.335"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="172" x="329.5" y="779.4736">handle_request simply puts</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="182" x="329.5" y="793.4424">messages in a python queue</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="329.5" y="807.4111">so that multiple threads</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="116" x="329.5" y="821.3799">can work on them.</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="61.9063" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="241" x="300" y="869.21"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="111" x="310" y="890.3486">slapdsock.service</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="221" x="310" y="904.3174">.SlapdSockServer.handle_request()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="310" y="918.2861">put message into queue</text><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="420.5,593.3975,432.5,605.3975,420.5,617.3975,408.5,605.3975,420.5,593.3975" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="357.5,979.1162,483.5,979.1162,495.5,991.1162,483.5,1003.1162,357.5,1003.1162,345.5,991.1162,357.5,979.1162" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="118" x="361.5" y="994.9243">no SIGINT / SIGTERM</text><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="673.1064" style="stroke: #000000; stroke-width: 2.0;" width="832.5" x="593" y="420.0098"/><path d="M705,421.0098 L705,445.6035 L695,455.6035 L593,455.6035 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="596" y="434.0049">SocketServer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="596" y="450.3018">Worker Thread</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="899" y="516.6035"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="909" y="537.7422">get message from queue</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="85.875" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="235" x="870.5" y="577.1123"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="880.5" y="598.251">handler.handle(message)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="870.5" x2="1105.5" y1="606.0811" y2="606.0811"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="870.5" x2="1105.5" y1="608.0811" y2="608.0811"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="215" x="880.5" y="622.2197">Execute SlapdSockHandler.handle</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="185" x="880.5" y="636.1885">to parse the socket message</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="213" x="880.5" y="650.1572">and determine the ldap operation</text><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="931,697.9873,1045,697.9873,1057,709.9873,1045,721.9873,931,721.9873,919,709.9873,931,697.9873" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="114" x="931" y="713.7954">ldap_operation_type</text><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="242.1719" style="stroke: #000000; stroke-width: 2.0;" width="383" x="603" y="744.792"/><path d="M687,745.792 L687,754.0889 L677,764.0889 L603,764.0889 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="606" y="758.7871">do_result()</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="175" x="707" y="781.0889"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="155" x="717" y="802.2275">write message to journal</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="248" x="670.5" y="850.0576"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="228" x="680.5" y="871.1963">put message into `outgoing_queue`</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="363" x="613" y="919.0264"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="141" x="623" y="940.165">release back-pressure</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="343" x="623" y="954.1338">by removing an object from the `backpressure_queue`</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="85.875" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="252" x="1006" y="744.792"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="1016" y="765.9307">do_delete()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="1016" y="779.8994">do_modify()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="1016" y="793.8682">do_modrdn()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1006" x2="1258" y1="801.6982" y2="801.6982"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1006" x2="1258" y1="803.6982" y2="803.6982"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="232" x="1016" y="817.8369">add object to `backpressure_queue`</text><rect fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" height="99.8438" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1278" y="744.792"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="56" x="1288" y="765.9307">do_add()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="59" x="1288" y="779.8994">do_bind()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="1288" y="793.8682">do_search()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="12" x="1288" y="807.8369">...</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1278" x2="1373" y1="815.667" y2="815.667"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1278" x2="1373" y1="817.667" y2="817.667"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="68" x="1288" y="831.8057">do nothing</text><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="988,1013.1162,988,1013.1162,1000,1025.1162,988,1037.1162,988,1037.1162,976,1025.1162,988,1013.1162" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="988,472.6035,1000,484.6035,988,496.6035,976,484.6035,988,472.6035" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f8mmnx1rlwuqj)" points="925,1057.1162,1051,1057.1162,1063,1069.1162,1051,1081.1162,925,1081.1162,913,1069.1162,925,1057.1162" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="118" x="929" y="1072.9243">no SIGINT / SIGTERM</text><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="72.5938" style="stroke: #000000; stroke-width: 2.0;" width="126" x="1435.5" y="761.96"/><path d="M1551.5,762.96 L1551.5,787.5537 L1541.5,797.5537 L1435.5,797.5537 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1438.5" y="775.9551">SocketServer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1438.5" y="792.252">Worker  Thread</text><rect fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" height="72.5938" style="stroke: #000000; stroke-width: 2.0;" width="126" x="1571.5" y="761.96"/><path d="M1687.5,762.96 L1687.5,787.5537 L1677.5,797.5537 L1571.5,797.5537 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="92" x="1574.5" y="775.9551">SocketServer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="106" x="1574.5" y="792.252">Worker  Thread</text><rect fill="#000000" filter="url(#f8mmnx1rlwuqj)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1423.5" x="286" y="1113.1162"/><rect fill="#000000" filter="url(#f8mmnx1rlwuqj)" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="1721.5" x="10" y="1151.1162"/><ellipse cx="877.75" cy="1188.1162" fill="#FFFFFF" filter="url(#f8mmnx1rlwuqj)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="877.75" cy="1188.1162" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="30" y2="50"/><polygon fill="#A80036" points="873.75,40,877.75,50,881.75,40,877.75,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="97.9375" y2="117.9375"/><polygon fill="#A80036" points="873.75,107.9375,877.75,117.9375,881.75,107.9375,877.75,111.9375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="151.9063" y2="171.9063"/><polygon fill="#A80036" points="873.75,161.9063,877.75,171.9063,881.75,161.9063,877.75,165.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="205.875" y2="225.875"/><polygon fill="#A80036" points="873.75,215.875,877.75,225.875,881.75,215.875,877.75,219.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="703.6396" y2="738.6396"/><polygon fill="#A80036" points="131,728.6396,135,738.6396,139,728.6396,135,732.6396" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="772.6084" y2="807.6084"/><polygon fill="#A80036" points="131,797.6084,135,807.6084,139,797.6084,135,801.6084" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="621.6709" y2="669.6709"/><polygon fill="#A80036" points="131,659.6709,135,669.6709,139,659.6709,135,663.6709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="210" x2="250" y1="901.5771" y2="901.5771"/><polygon fill="#A80036" points="246,765.624,250,755.624,254,765.624,250,761.624" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="250" x2="250" y1="609.6709" y2="901.5771"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="250" x2="147" y1="609.6709" y2="609.6709"/><polygon fill="#A80036" points="157,605.6709,147,609.6709,157,613.6709,153,609.6709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="841.5771" y2="889.5771"/><polygon fill="#A80036" points="131,879.5771,135,889.5771,139,879.5771,135,883.5771" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="699.3662" y2="734.3662"/><polygon fill="#A80036" points="416.5,724.3662,420.5,734.3662,424.5,724.3662,420.5,728.3662" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="834.21" y2="869.21"/><polygon fill="#A80036" points="416.5,859.21,420.5,869.21,424.5,859.21,420.5,863.21" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="617.3975" y2="665.3975"/><polygon fill="#A80036" points="416.5,655.3975,420.5,665.3975,424.5,655.3975,420.5,659.3975" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="495.5" x2="553" y1="991.1162" y2="991.1162"/><polygon fill="#A80036" points="549,808.2568,553,798.2568,557,808.2568,553,804.2568" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="553" x2="553" y1="605.3975" y2="991.1162"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="553" x2="432.5" y1="605.3975" y2="605.3975"/><polygon fill="#A80036" points="442.5,601.3975,432.5,605.3975,442.5,609.3975,438.5,605.3975" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="931.1162" y2="979.1162"/><polygon fill="#A80036" points="416.5,969.1162,420.5,979.1162,424.5,969.1162,420.5,973.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="550.5723" y2="577.1123"/><polygon fill="#A80036" points="984,567.1123,988,577.1123,992,567.1123,988,571.1123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="794.5" x2="794.5" y1="815.0576" y2="850.0576"/><polygon fill="#A80036" points="790.5,840.0576,794.5,850.0576,798.5,840.0576,794.5,844.0576" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="794.5" x2="794.5" y1="884.0264" y2="919.0264"/><polygon fill="#A80036" points="790.5,909.0264,794.5,919.0264,798.5,909.0264,794.5,913.0264" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="919" x2="794.5" y1="709.9873" y2="709.9873"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="794.5" x2="794.5" y1="709.9873" y2="781.0889"/><polygon fill="#A80036" points="790.5,771.0889,794.5,781.0889,798.5,771.0889,794.5,775.0889" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="798.5" y="749.3462">RESULT</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1057" x2="1325.5" y1="709.9873" y2="709.9873"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1325.5" x2="1325.5" y1="709.9873" y2="744.792"/><polygon fill="#A80036" points="1321.5,734.792,1325.5,744.792,1329.5,734.792,1325.5,738.792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="1329.5" y="731.1978">Everything else</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="794.5" x2="794.5" y1="966.9639" y2="1025.1162"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="794.5" x2="976" y1="1025.1162" y2="1025.1162"/><polygon fill="#A80036" points="966,1021.1162,976,1025.1162,966,1029.1162,970,1025.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1325.5" x2="1325.5" y1="844.6357" y2="1025.1162"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1325.5" x2="1000" y1="1025.1162" y2="1025.1162"/><polygon fill="#A80036" points="1010,1021.1162,1000,1025.1162,1010,1029.1162,1006,1025.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1132" x2="1132" y1="709.9873" y2="744.792"/><polygon fill="#A80036" points="1128,734.792,1132,744.792,1136,734.792,1132,738.792" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="1136" y="731.1978">DELETE / MODIFY / MODRDN</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1132" x2="1132" y1="830.667" y2="1025.1162"/><polygon fill="#A80036" points="1128,1015.1162,1132,1025.1162,1136,1015.1162,1132,1019.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="662.9873" y2="697.9873"/><polygon fill="#A80036" points="984,687.9873,988,697.9873,992,687.9873,988,691.9873" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="496.6035" y2="516.6035"/><polygon fill="#A80036" points="984,506.6035,988,516.6035,992,506.6035,988,510.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1063" x2="1385" y1="1069.1162" y2="1069.1162"/><polygon fill="#A80036" points="1381,824.5537,1385,814.5537,1389,824.5537,1385,820.5537" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1385" x2="1385" y1="484.6035" y2="1069.1162"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1385" x2="1000" y1="484.6035" y2="484.6035"/><polygon fill="#A80036" points="1010,480.6035,1000,484.6035,1010,488.6035,1006,484.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="1037.1162" y2="1057.1162"/><polygon fill="#A80036" points="984,1047.1162,988,1057.1162,992,1047.1162,988,1051.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="409.208" y2="593.3975"/><polygon fill="#A80036" points="416.5,583.3975,420.5,593.3975,424.5,583.3975,420.5,587.3975" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="409.208" y2="472.6035"/><polygon fill="#A80036" points="984,462.6035,988,472.6035,992,462.6035,988,466.6035" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1498.5" x2="1498.5" y1="409.208" y2="1113.1162"/><polygon fill="#A80036" points="1494.5,1103.1162,1498.5,1113.1162,1502.5,1103.1162,1498.5,1107.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1634.5" x2="1634.5" y1="409.208" y2="1113.1162"/><polygon fill="#A80036" points="1630.5,1103.1162,1634.5,1113.1162,1638.5,1103.1162,1634.5,1107.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="420.5" x2="420.5" y1="1003.1162" y2="1113.1162"/><polygon fill="#A80036" points="416.5,1103.1162,420.5,1113.1162,424.5,1103.1162,420.5,1107.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="988" x2="988" y1="1081.1162" y2="1113.1162"/><polygon fill="#A80036" points="984,1103.1162,988,1113.1162,992,1103.1162,988,1107.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1016.75" x2="1016.75" y1="383.208" y2="403.208"/><polygon fill="#A80036" points="1012.75,393.208,1016.75,403.208,1020.75,393.208,1016.75,397.208" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="285.8438" y2="597.6709"/><polygon fill="#A80036" points="131,587.6709,135,597.6709,139,587.6709,135,591.6709" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1016.75" x2="1016.75" y1="285.8438" y2="349.2393"/><polygon fill="#A80036" points="1012.75,339.2393,1016.75,349.2393,1020.75,339.2393,1016.75,343.2393" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="135" x2="135" y1="913.5771" y2="1151.1162"/><polygon fill="#A80036" points="131,1141.1162,135,1151.1162,139,1141.1162,135,1145.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1016.75" x2="1016.75" y1="1119.1162" y2="1151.1162"/><polygon fill="#A80036" points="1012.75,1141.1162,1016.75,1151.1162,1020.75,1141.1162,1016.75,1145.1162" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="259.8438" y2="279.8438"/><polygon fill="#A80036" points="873.75,269.8438,877.75,279.8438,881.75,269.8438,877.75,273.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="877.75" x2="877.75" y1="1157.1162" y2="1177.1162"/><polygon fill="#A80036" points="873.75,1167.1162,877.75,1177.1162,881.75,1167.1162,877.75,1171.1162" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[915c48690614077b51e22dcf368db6b5]
@startuml LDIF Producer Activity Diagram
start

:socketserver = slapdsock.service.SlapdSockServer()
:handler = slapdsocklistener.LDAPHandler(ReasonableSlapdSockHandler(SlapdSockHandler(BaseRequestHandler)));

:Start event loop;
:Connect to NATS;
:Read jornal and send pending old messages to NATS;

fork

partition "Send Messages to NATS" {
repeat
:get message from queue;
:send message to NATS;
:remove message from journal;
repeat while ( no SIGINT / SIGTERM )
}

fork again
    partition "SocketServer\nMain Thread" {
        :socketserver.serve_forever();
    fork
        repeat
            :listen for messages in the socket;
            :handle_request()
            ====
            handle_request simply puts
            messages in a python queue
            so that multiple threads
            can work on them.;

            :slapdsock.service
            .SlapdSockServer.handle_request()
            put message into queue;
        repeat while ( no SIGINT / SIGTERM )

    fork again

        partition "SocketServer\nWorker Thread" {
            repeat
                :get message from queue;
                :handler.handle(message)
                ====
                Execute SlapdSockHandler.handle
                to parse the socket message
                and determine the ldap operation;
                switch (ldap_operation_type)
                case ( RESULT )
                    partition "do_result()" {
                        :write message to journal;
                        :put message into `outgoing_queue`;
                        :release back-pressure
                        by removing an object from the `backpressure_queue`;
                    }
                case ( DELETE / MODIFY / MODRDN )
                    :do_delete()
                    do_modify()
                    do_modrdn()
                    ====
                    add object to `backpressure_queue`;
                case ( Everything else )
                    :do_add()
                    do_bind()
                    do_search()
                    ...
                    ====
                    do nothing;
                endswitch
            repeat while ( no SIGINT / SIGTERM )
        }
    fork again
        partition "SocketServer\nWorker  Thread" {
        }
    fork again
        partition "SocketServer\nWorker  Thread" {
        }

    end fork
        }

end fork

stop

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.10+7-Ubuntu-122.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>
