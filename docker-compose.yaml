---

version: '3.5'

services:
  listener:
    #build: './listener'
    image: bash:latest
    env_file: .env.listener
    entrypoint: ["bash", "-c", "sleep 10; tail -f /var/lib/univention-ldap/listener/listener"]
    volumes:
      - listener-data:/var/lib/univention-ldap/listener/:ro
  openldap:
    build: './images/univention-openldap'
    image: docker-registry.knut.univention.de/univention-openldap:latest
    env_file: .env.univention-openldap
    ports:
      - 389:389
      - 636:636
    volumes:
      - notify-transaction-data:/var/lib/univention-ldap/notify/:ro
      - db-data:/var/lib/univention-ldap/ldap/:rw
      - last-id-data:/var/lib/univention-ldap/last-id-data/:rw
      - translog-data:/var/lib/univention-ldap/translog/:rw
      - listener-data:/var/lib/univention-ldap/listener/:rw

volumes:
  # OpenLDAP only:
  db-data:
  last-id-data:
  translog-data:
  # Notifier + OpenLDAP
  notify-transaction-data:
  # Listener + OpenLDAP
  listener-data:
    driver_opts:
      type: tmpfs
      device: tmpfs

...
